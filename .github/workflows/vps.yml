name: VPS + Puppeteer

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4

      - name: Setup tmate
        run: |
          curl -fsSL https://github.com/tmate-io/tmate/releases/download/2.4.0/tmate-2.4.0-static-linux-amd64.tar.xz | tar -xJ
          chmod +x tmate-2.4.0-static-linux-amd64/tmate

          echo "=== VPS Link - $(date) ===" > remote-link.txt
          echo "" >> remote-link.txt

          ./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate new-session -d "bash"
          sleep 8

          SSH_LINK=$(./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate display -p '#{tmate_ssh}')
          WEB_LINK=$(./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate display -p '#{tmate_web}')

          echo "SSH: $SSH_LINK" >> remote-link.txt
          echo "Web: $WEB_LINK" >> remote-link.txt
          echo "---" >> remote-link.txt

          echo "âœ… VPS ready!"
          echo "SSH: $SSH_LINK"
          echo "Web: $WEB_LINK"

      - name: Commit tmate link
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "github-actions"
          git add remote-link.txt
          git commit -m "VPS Puppeteer link - $(date)" || exit 0
          git push https://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@github.com/${{ github.repository }} HEAD:main || exit 0

      - name: Keep alive
        run: |
          echo "ðŸ”¥ VPS ready!"
          echo "ðŸ“‹ Check remote-link.txt for SSH/Web link"
          sleep 1500
