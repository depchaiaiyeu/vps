name: VPS + Puppeteer Real Browser + Repo

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
      - uses: actions/checkout@v4

      - name: Setup tmate + Puppeteer Real Browser + Repo
        run: |
          curl -fsSL https://github.com/tmate-io/tmate/releases/download/2.4.0/tmate-2.4.0-static-linux-amd64.tar.xz | tar -xJ
          chmod +x tmate-2.4.0-static-linux-amd64/tmate
          echo "=== VPS Link - $(date) ===" > remote-link.txt
          echo "" >> remote-link.txt
          ./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate new-session -d "bash"
          sleep 8
          SSH_LINK=$(./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate display -p '#{tmate_ssh}')
          WEB_LINK=$(./tmate-2.4.0-static-linux-amd64/tmate -S /tmp/tmate display -p '#{tmate_web}')
          echo "SSH: $SSH_LINK" >> remote-link.txt
          echo "Web: $WEB_LINK" >> remote-link.txt
          echo "---" >> remote-link.txt
          echo "âœ… VPS ready!"
          echo "SSH: $SSH_LINK"
          echo "Web: $WEB_LINK"
          sudo apt-get update
          sudo apt-get install -y wget unzip fonts-liberation libx11-xcb1 libxcomposite1 \
            libxcursor1 libxdamage1 libxi6 libxtst6 libnss3 libxrandr2 libatk1.0-0 \
            libatk-bridge2.0-0 libcups2 libdbus-1-3 libdrm2 libxss1 libgbm1 xdg-utils
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
          sudo apt-get install -y nodejs git
          cd /tmp
          git clone https://github.com/depchaiaiyeu/dos-bot
          cd dos-bot
          npm install puppeteer-real-browser
          echo "âœ… Puppeteer Real Browser + Repo installed!"

      - name: Commit tmate link
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "github-actions"
          git add remote-link.txt
          git commit -m "VPS Puppeteer Real Browser + Repo link - $(date)" || exit 0
          git push https://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@github.com/${{ github.repository }} HEAD:main || exit 0

      - name: Keep alive
        run: |
          echo "ðŸ”¥ VPS with Puppeteer Real Browser + Repo ready!"
          echo "ðŸ“‹ Check remote-link.txt for SSH/Web link"
          sleep 1500
